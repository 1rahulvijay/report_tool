version: '3.8'

services:
  # Unified API service - handles all metadata, queries, and strictly streaming exports
  aurora-api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:8081"
      - "8080:8080"
    environment:
      - WORKER_COUNT=4
      - ENVIRONMENT=production
      - ORACLE_MAX_POOL=30 # Increased for 200 concurrent users
      - PREVIEW_MAX_ROWS=500
      - QUERY_TIMEOUT_SECONDS=120
    env_file:
      - backend/.env
    deploy:
      resources:
        limits:
          memory: 6G # Increased to handle in-memory streaming exports
          cpus: '3.0'
    restart: unless-stopped
